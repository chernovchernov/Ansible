---
# tasks file for wp-install

#- name: Update packeges
#  apt: name=* state=latest

#- name: Install apache2
#  apt: name=apache2 state=latest

#- name: Install ghostscript
#  apt: name=ghostscript state=latest

#- name: Install libapache2-mod-php
#  apt: name=libapache2-mod-php state=latest

#- name: Install mysql-server
#  apt: name=mysql-server state=latest

#- name: Install php
#  apt: name=php state=latest

#- name: Install php-bcmath
#  apt: name=php-bcmath state=latest

#- name: Install php-curl
#  apt: name=php-curl state=latest

#- name: Install php-imagick
#  apt: name=php-imagick state=latest

#- name: Install php-intl
#  apt: name=php-intl state=latest

#- name: Install php-json
#  apt: name=php-json state=latest

#- name: Install php-mbstring
#  apt: name=php-mbstring state=latest

#- name: Install php-mysql
#  apt: name=php-mysql state=latest

#- name: Install php-xml
#  apt: name=php-xml state=latest

#- name: Install php-zip
#  apt: name=php-zip state=latest

#- name: Install PIP
#  apt: name=pip state=latest

#- name: Install PyMySQL
#  pip: name=pymysql state=present 

#- name: Making Directory of Wordpress
#  shell: mkdir -p /var/www/
  
#- name: Changing Owner
#  shell: chown www-data:www-data /var/www/
   
#- name: Get and Install WP
#  shell: curl https://wordpress.org/latest.tar.gz | sudo -u www-data tar zx -C /var/www

#- name: Set Access to Folder
#  shell: chmod 755 /var/www/wordpress

#- name: Create private key (RSA, 4096 bits)
#  community.crypto.openssl_privatekey:
#    path: /etc/ssl/private/wordpress.key

#- name: Create simple self-signed certificate
#  community.crypto.x509_certificate:
#    path: /etc/ssl/certs/wordpress.crt
#    privatekey_path: /etc/ssl/private/wordpress.key
#    provider: selfsigned

#- block:

#  - name: Writing IP adress to the etc/hosts file
#    shell: echo 192.168.31.81 www.one.wordpress.ru one.wordpress.ru >> /etc/hosts 

#  - name: Create WordPress Config File
#    template: src=wordpress.j2 dest={{ destin_folder }}/wordpress.conf mode=0644
#    vars:
#      servername: one.wordpress.ru
#      redirect: https://one.wordpress.ru

#  - name: Create SSL WordPress Config File
#    template: src=ssl-wordpress.j2 dest={{ destin_folder }}/ssl-wordpress.conf mode=0644
#    vars:
#      servername: one.wordpress.ru

#  when: ansible_all_ipv4_addresses == ['192.168.31.81']

#- block:

#  - name: Writing IP adress to the etc/hosts file
#    shell: echo 192.168.31.216 www.two.wordpress.ru two.wordpress.ru >> /etc/hosts

#  - name: Create WordPress Config File
#    template: src=wordpress.j2 dest={{ destin_folder }}/wordpress.conf mode=0644
#    vars:
#      servername: two.wordpress.ru
#      redirect: https://two.wordpress.ru

#  - name: Create SSL WordPress Config File
#    template: src=ssl-wordpress.j2 dest={{ destin_folder }}/ssl-wordpress.conf mode=0644
#    vars:
#      servername: two.wordpress.ru

#  when: ansible_all_ipv4_addresses == ['192.168.31.216']

#- name: Enable the site
#  shell: sudo a2ensite wordpress

#- name: Enable URL rewrite 
#  shell: sudo a2enmod rewrite

#- name: Disable the default “It Works” site  
#  shell: sudo a2dissite 000-default

#- name: Activate SSL config
#  shell: sudo a2ensite ssl-wordpress.conf

#- name: Activate SSL_MOD
#  shell:  sudo a2enmod ssl

#- name: Apache2 Start
#  service: name=apache2 state=started

#- name: Start  mySQL Service
#  shell: sudo mysql -u root

- name: Change root password (fail is not a problem)
  mysql_user:
    name: root
    password: - name: Change root password (fail is not a problem)
  mysql_user:
    name: root
    password: "{{ mysql_root_password}}"
  ignore_errors: yes- name: Change root password (fail is not a problem)
  mysql_user:
    name: root
    password: "{{ mysql_root_password}}"
  ignore_errors: yes- name: Change root password (fail is not a problem)
  mysql_user:
    name: root
    password: "{{ mysql_root_password}}"
  ignore_errors: yes"
    ignore_errors: yes



- block: 

#  - name: Create Database MySQL on Server 1
#    mysql_db: name=database_one state=present
#   - name: Create DataBase MySQL
#     ansible.builtin.shell: quit;

   - name: creating database
     mysql_db:
       name: "DB1"
       state: "present"
       login_user: "root"
       login_password: "{{ mysql_"

   - name: creating database user
     mysql_user:
       name: "{{ db_user }}"
       password: "{{ db_password }}"
       priv: "{{ db_name }}.*:ALL"
       state: "present"
       login_user: "root"
       login_password: "{{ mysql_root_password }}"

#  - name: Create User MySQL on Server 1
#    mysql_user: name=user_one password=1111 priv=user_one.*:ALL host='%' state=present
  
#  - name: Restart MySQL
#    service: name=mysql state=restarted

#  - name: Configure WordPress to connect to the database #
#   shell: sudo -u www-data cp /var/www/wordpress/wp-config-sample.php /var/www/wordpress/wp-config.php

#  - name: Change DB Name
#    shell: sudo -u www-data sed -i 's/database_one/wordpress/' /var/www/wordpress/wp-config.php

#  - name: Change User Name
#    shell: sudo -u www-data sed -i 's/user_one/wordpress/' /var/www/wordpress/wp-config.php

#  - name: Change Password
#    shell: sudo -u www-data sed -i 's/password_here/1111/' /var/www/wordpress/wp-config.php

  when: ansible_all_ipv4_addresses == ['192.168.31.81']

#- block:

#  - name: Create Database MySQL on Server 2
#    mysql_db: name=database_two state=present

#  - name: Create User MySQL on Server 2
#    mysql_user: name=user_two password=2222 priv=user_one.*:ALL host='%' state=present

#  - name: Restart MySQL
#    service: name=mysql state=restarted

#  - name: Configure WordPress to connect to the database
#    shell: sudo -u www-data cp /var/www/wordpress/wp-config-sample.php /var/www/wordpress/wp-config.php

#  - name: Change DB Name
#    shell: sudo -u www-data sed -i 's/database_two/wordpress/' /var/www/wordpress/wp-config.php

#  - name: Change User Name
#    shell: sudo -u www-data sed -i 's/user_two/wordpress/' /var/www/wordpress/wp-config.php

#  - name: Chenge Password
#    shell: sudo -u www-data sed -i 's/password_here/2222/' /var/www/wordpress/wp-config.php

#  when: ansible_all_ipv4_addresses == ['192.168.31.216']


- name: 1
  shell: sudo -u www-data sed -i 's/'AUTH_KEY',         'put your unique phrase here'/'AUTH_KEY',         'nt#*ZXdC}+j#Dk1B+Eir&L2iecj-^ivx}(wsE+jQR5kA40MnGXp-}x[N6YekUHn:'/' /var/www/wordpress/wp-config.php
  
- name: 2
  shell: sudo -u www-data sed -i 's/'SECURE_AUTH_KEY',         'put your unique phrase here'/'SECURE_AUTH_KEY',  '/aTZxhtxqdVMf):FW6$+_^ DfW?(>gh9:0GP3~w}-OS9Op2}4mlXNgxNpL}?BI8z'/' /var/www/wordpress/wp-config.php
  
- name: 3  
  shell: sudo -u www-data sed -i 's/'LOGGED_IN_KEY',         'put your unique phrase here'/'LOGGED_IN_KEY',    'YW;wo@Eoagx_kwXRlk)TxlgJ{.U-j?(R:d-Di-eXdV$Jp-_9G(*#~e4<c`x|K.,y'/' /var/www/wordpress/wp-config.php
  
- name: 4
  shell: sudo -u www-data sed -i 's/'NONCE_KEY',         'put your unique phrase here'/'NONCE_KEY',        'ObX#cs%?aQcC}|1F/LhF]-XRqy<e2RY^#Rwh`XhdT7n|J-)SHUpDp-&iMa+}]=@#'/' /var/www/wordpress/wp-config.php
  
- name: 5
  shell: sudo -u www-data sed -i 's/'AUTH_SALT',         'put your unique phrase here'/'AUTH_SALT',        'F%D3(FYvj1/*E0|4@:6nE$e4(Y0#9n7Obqu}S&#-m]|)_Fbb[rU57.Cw|M$_:uQK'/' /var/www/wordpress/wp-config.php
  
- name: 6
  shell: sudo -u www-data sed -i 's/'SECURE_AUTH_SALT',         'put your unique phrase here'/'SECURE_AUTH_SALT', 'rPp9Z}(ES:.oEpdOm0$`G(mk-]p(@a:+>)9o yP~I*BRTnDqMB-2L?myZz_69s1d'/' /var/www/wordpress/wp-config.php
  
- name: 7
  shell: sudo -u www-data sed -i 's/'LOGGED_IN_SALT',         'put your unique phrase here'/'LOGGED_IN_SALT',   '-)osbuCh?`p6rO;t`#PM:1-x+HZKB N+T@Wu411^Nd4-SlIw+t]c@OS:C97#Kk}9'/' /var/www/wordpress/wp-config.php
  
- name: 8
  shell: sudo -u www-data sed -i 's/'NONCE_SALT',         'put your unique phrase here'/'NONCE_SALT',       'nwmso1rkg0./wqe-o#V+S`z-IcJz-oL|#EBS1h,m4*hzN[<GssRd7H,G1JV9s$/~'/' /var/www/wordpress/wp-config.php

